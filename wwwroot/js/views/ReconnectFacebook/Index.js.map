{"version":3,"file":"Index.js","mappings":"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","sources":["webpack://vjs/webpack/universalModuleDefinition","webpack://vjs/./Views/Shared/Constants.ts","webpack://vjs/webpack/bootstrap","webpack://vjs/./Views/ReconnectFacebook/Index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vjs\"] = factory();\n\telse\n\t\troot[\"vjs\"] = factory();\n})(self, () => {\nreturn ","// 'business_management' is required for viewing pages managed by the user\r\nexport const PERMISSIONS: string[] = ['email', 'public_profile', 'business_management', 'pages_manage_metadata',\r\n    'pages_messaging', 'pages_manage_posts', 'pages_manage_engagement', 'instagram_basic', 'instagram_content_publish',\r\n    'instagram_manage_comments', 'instagram_manage_messages'];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { PERMISSIONS } from '../Shared/Constants';\r\n\r\ndeclare const vdata: {\r\n    actions: {\r\n        refreshAccessToken: string;\r\n    };\r\n    localizer: {\r\n        cancel: string;\r\n        confirm: string;\r\n        confirmation: string;\r\n        fbConnected: string;\r\n        fbNotConnected: string;\r\n        finalWarning: string;\r\n    };\r\n    settings: {\r\n        metaApiID: string;\r\n        metaApiVersion: string;\r\n        shortName: string;\r\n    };\r\n};\r\n\r\n// https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/facebook-js-sdk/index.d.ts\r\n/// <reference types=\"facebook-js-sdk\" />\r\n\r\n// The order of the following three code blocks is extremely important. It has to be:\r\n// (1) fbAsyncInit, (2) IIFE, then (3) whatever needs to run upon DOM being loaded\r\n// For reference, see: https://www.devils-heaven.com/facebook-javascript-sdk-login\r\nwindow.fbAsyncInit = function () {    \r\n    FB.init({\r\n        appId: vdata.settings.metaApiID,\r\n        cookie: true,                     // Enable cookies to allow the server to access the session.\r\n        xfbml: true,                     // Parse social plugins on this webpage.\r\n        version: vdata.settings.metaApiVersion\r\n    });\r\n    \r\n    FB.getLoginStatus(function (response) {   // Called after the JS SDK has been initialized.\r\n        statusChangeCallback(response);        // Returns the login status.\r\n    });\r\n};\r\n\r\n(function (element: Document, tagName: string, selector: string) {\r\n    var js, fjs = element.getElementsByTagName(tagName)[0];\r\n    if (element.getElementById(selector)) { return; }\r\n    js = element.createElement(tagName); js.id = selector;\r\n    js.src = \"https://connect.facebook.net/en_US/sdk.js\";\r\n    fjs.parentNode.insertBefore(js, fjs);\r\n}(document, 'script', 'facebook-jssdk')\r\n);\r\n\r\n$(function () {    \r\n    $('#loginBtn').on('click', function () {        \r\n        FB.login((response: facebook.StatusResponse) => {\r\n            if (response.authResponse) { checkLoginState(); }\r\n        }, {\r\n            scope: PERMISSIONS.toString(),\r\n            return_scopes: true\r\n        });\r\n    });\r\n\r\n    $('#logoutBtn').on('click', function () {        \r\n        FB.logout(checkLoginState);\r\n    });\r\n})\r\n\r\n/**\r\n * Check the user's FB login status\r\n */\r\nfunction checkLoginState() {\r\n    FB.getLoginStatus(function (response) {\r\n        statusChangeCallback(response)\r\n    })\r\n}\r\n\r\n/**\r\n * React to change in the user's Facebook login status\r\n * @param response-Facebook's response to getLoginStatus()\r\n */\r\nfunction statusChangeCallback(response: facebook.StatusResponse) {  // Called with the results from FB.getLoginStatus().    \r\n    if (response?.status === 'connected') {\r\n        $('#loginBtn').hide();\r\n        $('#logoutBtn').show();\r\n        reassignMetaProfile(response.authResponse?.userID, response.authResponse?.accessToken, false);\r\n    } else {\r\n        // Not logged into Facebook or we are unable to tell.\r\n        $('#loginBtn').show();\r\n        $('#logoutBtn').hide();\r\n        $('#reconnect-warning').show();\r\n        const alert =\r\n            `<div class=\"alert alert-warning\">` +\r\n                `<i class=\"fa-regular fa-circle-exclamation\"></i>` +\r\n                `&nbsp;${vdata.localizer.fbNotConnected.replaceAll('{0}', vdata.settings.shortName)}` +\r\n            `</div>`\r\n        $('#reconnect-dialogue').empty().append(alert);\r\n    }\r\n}\r\n\r\n/**\r\n * Pass the short-lived user access token to server, which will check if another active Meta profile exists for the same Meta ID\r\n * @param metaId-Facebook user ID\r\n * @param accessToken-Short-lived user access token \r\n * @param reAssignMetaProfile-True if the Facebook account can be reassigned from one organization to another\r\n * @returns\r\n */\r\nfunction reassignMetaProfile(metaId: string, accessToken: string, reAssignMetaProfile: boolean) {\r\n    return $.post({\r\n        url: vdata.actions.refreshAccessToken,\r\n        data: {\r\n            metaId: metaId,\r\n            token: accessToken,\r\n            reAssignMetaProfile: reAssignMetaProfile,\r\n        }\r\n    }).done(function () {\r\n        $('#reconnect-warning').hide();\r\n        FB.api('/me', { fields: 'name' }, function (response: facebook.User) {\r\n            const alert =\r\n                `<div class=\"alert alert-success my-3\">` +\r\n                `<i class=\"fa-regular fa-circle-check\"></i>` +\r\n                `&nbsp;${vdata.localizer.fbConnected.replaceAll('{0}', response.name).replaceAll('{1}', vdata.settings.shortName)}` +\r\n                `</div>`\r\n            $('#reconnect-dialogue').empty().append(alert);\r\n        });\r\n    }).fail(function (jqXHR, textStatus, errorThrown) {\r\n        // note: 409 means that another organization is connected with the Facebook account\r\n        if (jqXHR.status !== 409) {\r\n            FB.logout(checkLoginState);\r\n            return corprio.formatError(jqXHR, textStatus, errorThrown);\r\n        }\r\n        \r\n        var prompt = DevExpress.ui.dialog.custom({\r\n            title: vdata.localizer.confirmation,\r\n            messageHtml: `<p>${vdata.localizer.finalWarning}</p>`,\r\n            buttons: [{\r\n                text: vdata.localizer.confirm,\r\n                onClick: function () { reassignMetaProfile(metaId, accessToken, true); },\r\n                type: \"danger\",\r\n            }, {\r\n                text: vdata.localizer.cancel,\r\n                onClick: function () { FB.logout(checkLoginState); },\r\n                type: \"normal\",\r\n            }]\r\n        });\r\n        prompt.show();        \r\n    });\r\n}\r\n"],"names":[],"sourceRoot":""}