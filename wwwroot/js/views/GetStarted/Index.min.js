!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.vjs=t():e.vjs=t()}(self,(()=>(()=>{"use strict";var e={58:(e,t)=>{var a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.Selector=t.MessageType=void 0,function(e){e.CataloguePost="CataloguePost",e.ProductPost="ProductPost"}(a||(t.MessageType=a={})),function(e){e.addComponentButton_Catalogue="#component-btn-catalogue",e.addCustomTextButton_Catalogue="#custom-btn-catalogue",e.addComponentButton_Product="#component-btn-product",e.addCustomTextButton_Product="#custom-btn-product",e.blockPanel_Catalogue="#block-panel-catalogue",e.blockPanel_Catalogue_RemoveButton_Last="#block-panel-catalogue .remove-btn:last",e.blockPanel_Catalogue_Input_Last="#block-panel-catalogue .custom-block:last",e.blockPanel_Catalogue_DragBlock_Last="#block-panel-catalogue .drag-block:last",e.blockPanel_Product="#block-panel-product",e.blockPanel_Product_RemoveButton_Last="#block-panel-product .remove-btn:last",e.blockPanel_Product_Input_Last="#block-panel-product .custom-block:last",e.blockPanel_Product_DragBlock_Last="#block-panel-product .drag-block:last",e.catalogueSetting="#catalogue-setting",e.componentSelect_Catalogue="#component-select-catalogue",e.componentSelect_Product="#component-select-product",e.customTextInput_Catalogue="#custom-input-catalogue",e.customTextInput_Product="#custom-input-product",e.fbDialogue="#fb-dialogue",e.fbDialogue2="#fb-dialogue2",e.keywordInput_Product="#keyword-input-product",e.loadIndicator_Top="#load-indicator-top",e.loginButton="#loginBtn",e.logoutButton="#logoutBtn",e.previewButtons=".preview-btn",e.previewPanel_Catalogue="#preview-panel-catalogue",e.previewPanel_Product="#preview-panel-product",e.restoreDefaultButton_Catalogue="#restore-default-btn-catalogue",e.restoreDefaultButton_Product="#restore-default-btn-product",e.saveSettingButtons=".save-setting-btn",e.saveTemplateButton_Catalogue="#save-template-btn-catalogue",e.saveTemplateButton_Product="#save-template-btn-product"}(o||(t.Selector=o={}))},28:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WEBHOOKS=t.PERMISSIONS=void 0,t.PERMISSIONS=["email","public_profile","business_management","pages_show_list","pages_manage_metadata","pages_messaging","pages_manage_posts","instagram_basic","instagram_content_publish","instagram_manage_messages"],t.WEBHOOKS=["messages"]}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,a),l.exports}var o={};return(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0});const t=a(58),n=a(28),l="true-value",s="reordered",c="swapped",r={CataloguePost:{blockPanel:t.Selector.blockPanel_Catalogue,blockPanelInput_Last:t.Selector.blockPanel_Catalogue_Input_Last,componentSelect:t.Selector.componentSelect_Catalogue,componentAddButton:t.Selector.addComponentButton_Catalogue,customTextInput:t.Selector.customTextInput_Catalogue,customTextAddButton:t.Selector.addCustomTextButton_Catalogue,saveTemplateButton:t.Selector.saveTemplateButton_Catalogue,restoreDefaultButton:t.Selector.restoreDefaultButton_Catalogue,previewPanel:t.Selector.previewPanel_Catalogue,removeButton_Last:t.Selector.blockPanel_Catalogue_RemoveButton_Last,dragBlock_Last:t.Selector.blockPanel_Catalogue_DragBlock_Last,validSelectOptions:{}},ProductPost:{blockPanel:t.Selector.blockPanel_Product,blockPanelInput_Last:t.Selector.blockPanel_Product_Input_Last,componentSelect:t.Selector.componentSelect_Product,componentAddButton:t.Selector.addComponentButton_Product,customTextInput:t.Selector.customTextInput_Product,customTextAddButton:t.Selector.addCustomTextButton_Product,saveTemplateButton:t.Selector.saveTemplateButton_Product,restoreDefaultButton:t.Selector.restoreDefaultButton_Product,previewPanel:t.Selector.previewPanel_Product,removeButton_Last:t.Selector.blockPanel_Product_RemoveButton_Last,dragBlock_Last:t.Selector.blockPanel_Product_DragBlock_Last,validSelectOptions:{}}};let i,u={};const p={value:null,type:null};function d(e,t){const a=$(e);p.value=a.data(l)in u?a.data(l):String(a.find("input").val()),p.type=t,a.data(s,!0)}function g(e){return`<span draggable="true" class="rounded border border-primary p-2 mx-1 mb-1 d-inline-block text-wrap drag-block"><input class="custom-block" value="${e}"><i class="fa-duotone fa-x ml-2 remove-btn"></i></span>`}function v(e,t){return`<span draggable="true" data-${l}="${e}" class="rounded border border-secondary p-2 mx-1 mb-1 d-inline-block text-wrap drag-block"><input disabled value="${t}"><i class="fa-duotone fa-x ml-2 remove-btn"></i></span>`}function m(e){console.log(vdata.model.productTemplate);const a=e===t.MessageType.CataloguePost?vdata.model.catalogueTemplate:vdata.model.productTemplate;a&&(f(a.split(vdata.templateComponents.separator),e),b(e))}function f(e,t){if(e){$(r[t].blockPanel).empty();for(let a=0;a<e.length;a++){if(!e[a])continue;const o=e[a]in r[t].validSelectOptions?v(e[a],r[t].validSelectOptions[e[a]].panel):g(e[a]);$(r[t].blockPanel).append(o),$(r[t].dragBlock_Last).on("dragstart",(function(){d(this,t)})),$(r[t].removeButton_Last).on("click",(function(){_(this,t)})),$(r[t].blockPanelInput_Last).on("keyup",(function(){b(t)}))}}}function P(e){const t={isValid:!0,keyword:"",templateString:""};return $(r[e].blockPanel).children("span").each((function(){const a=$(this).data(l);a in r[e].validSelectOptions?t.templateString+=a+vdata.templateComponents.separator:t.templateString+=S(String($(this).find("input").val()))+vdata.templateComponents.separator})),t}function b(e){$(r[e].previewPanel).empty();let a="";$(r[e].blockPanel).children("span").each((function(){const o=$(this).data(l);o in r[e].validSelectOptions?o===vdata.templateComponents.newLineValue?($(r[e].previewPanel).append(`<p class="m-0 text-truncate">${a||"&nbsp;"}</p>`),a=""):a+=e===t.MessageType.ProductPost&&o===vdata.templateComponents.defaultMessageValue?r[e].validSelectOptions[o].preview.replaceAll("{1}",r[e].validSelectOptions[vdata.templateComponents.productCodeValue].preview):r[e].validSelectOptions[o].preview:a+=S(String($(this).find("input").val()))})),$(r[e].previewPanel).append(`<p class="m-0 text-truncate">${a}</p>`)}function S(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#x27;").replaceAll(" ","&nbsp;")}function _(e,t){$(e.parentNode).remove(),b(t)}function k(e){let t=$(r[e].customTextInput).val();""!==t&&(t=S(String(t)),$(r[e].customTextInput).val(""),$(r[e].blockPanel).append(g(t)),$(r[e].dragBlock_Last).on("dragstart",(function(){d(this,e)})),$(r[e].removeButton_Last).on("click",(function(){_(this,e)})),$(r[e].blockPanelInput_Last).on("keyup",(function(){b(e)})),b(e))}function C(){i=$(t.Selector.loadIndicator_Top).dxLoadIndicator({visible:!1}).dxLoadIndicator("instance"),r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.newLineValue]={panel:"&#9166;",preview:"\n"},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.defaultMessageValue]={panel:"{"+vdata.localizer.defaultMessage+"}",preview:vdata.sampleValues.defaultCatalogueMessage},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.catalogueNameValue]={panel:"{"+vdata.localizer.catalogueName+"}",preview:"Example Catalogue"},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.catalogueCodeValue]={panel:"{"+vdata.localizer.catalogueEndDate+"}",preview:"EXAMPLE"},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.catalogueStartDateValue]={panel:"{"+vdata.localizer.catalogueStartDate+"}",preview:"01/12/2023"},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.catalogueEndDateValue]={panel:"{"+vdata.localizer.catalogueEndDate+"}",preview:"31/12/2023"},r[t.MessageType.CataloguePost].validSelectOptions[vdata.templateComponents.catalogueUrlValue]={panel:"{"+vdata.localizer.catalogueUrl+"}",preview:vdata.sampleValues.catalogueURL},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.newLineValue]={panel:"&#9166;",preview:"\n"},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.defaultMessageValue]={panel:"{"+vdata.localizer.defaultMessage+"}",preview:vdata.sampleValues.defaultProductMessage},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productNameValue]={panel:"{"+vdata.localizer.productName+"}",preview:"Example Product"},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productCodeValue]={panel:"{"+vdata.localizer.productCode+"}",preview:"EXAMPLE"},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productDescriptionValue]={panel:"{"+vdata.localizer.productDescription+"}",preview:"G.O.A.T."},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productListPriceValue]={panel:"{"+vdata.localizer.productListPrice+"}",preview:"HKD888"},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productPublicPriceValue]={panel:"{"+vdata.localizer.productPublicPrice+"}",preview:"HKD888.88"},r[t.MessageType.ProductPost].validSelectOptions[vdata.templateComponents.productReplyKeyword]={panel:"{"+vdata.localizer.productReplyKeyword+"}",preview:"BUY"},u=Object.assign(Object.assign({},r[t.MessageType.CataloguePost].validSelectOptions),r[t.MessageType.ProductPost].validSelectOptions)}function y(e){$(r[e].customTextAddButton).on("click",(function(){k(e)})),$(r[e].customTextInput).on("keydown",(function(t){"Enter"===t.key&&k(e)})),$(r[e].componentAddButton).on("click",(function(){!function(e){let t=String($(r[e].componentSelect).val());t in r[e].validSelectOptions&&($(r[e].blockPanel).append(v(t,r[e].validSelectOptions[t].panel)),$(r[e].dragBlock_Last).on("dragstart",(function(){d(this,e)})),$(r[e].removeButton_Last).on("click",(function(){_(this,e)})),b(e))}(e)})),$(r[e].restoreDefaultButton).on("click",(function(){!function(e){let a;switch(e){case t.MessageType.CataloguePost:a=vdata.templateComponents.defaultTemplate_catalogue.split(vdata.templateComponents.separator);break;case t.MessageType.ProductPost:a=vdata.templateComponents.defaultTemplate_product.split(vdata.templateComponents.separator)}f(a,e),b(e)}(e)})),$(r[e].blockPanel).on("drop",(function(t){!function(e,t){if(e.preventDefault(),t!==p.type)return;let a=$(e.target);(a.is("input")||a.is("i"))&&(a=a.parent());let o=!0;a.is("span")&&(a.data(c,!0),o=!1);let n="";$(r[t].blockPanel).children("span").each((function(){if($(this).data(s))return;$(this).data(c)&&(n+=p.value+vdata.templateComponents.separator);const e=$(this).data(l);e in r[t].validSelectOptions?n+=e+vdata.templateComponents.separator:n+=S(String($(this).find("input").val()))+vdata.templateComponents.separator})),o&&(n+=p.value),f(n.split(vdata.templateComponents.separator),t),b(t)}(t,e)})),$(r[e].blockPanel).on("dragover",(function(e){e.preventDefault()}))}function B(e){var a,o,n,l;if("connected"===(null==e?void 0:e.status))$(t.Selector.loginButton).hide(),$(t.Selector.logoutButton).show(),FB.api("/me",{fields:"name"},(function(e){const a=`<div class="alert alert-success my-3"><i class="fa-regular fa-circle-check"></i>&nbsp;${vdata.localizer.fbConnected.replaceAll("{0}",e.name).replaceAll("{1}",vdata.settings.shortName)}</div>`;$(t.Selector.fbDialogue).empty().append(a),$(t.Selector.fbDialogue2).empty()})),FB.api("/me/accounts",(function(e){if(e&&!e.error)for(let t=0;t<e.data.length;t++)h(e.data[t].id,e.data[t].access_token);else console.error(e.error)})),n=null===(a=e.authResponse)||void 0===a?void 0:a.userID,l=null===(o=e.authResponse)||void 0===o?void 0:o.accessToken,$.ajax({type:"POST",url:vdata.actions.refreshAccessToken,data:{metaId:n,token:l},success:function(){console.log(`Token for ${n} is fed to backend successfully.`),C(),m(t.MessageType.ProductPost),m(t.MessageType.CataloguePost),$(t.Selector.saveSettingButtons).removeAttr("disabled")},error:function(e,a,o){return $(t.Selector.saveSettingButtons).attr("disabled","disabled"),500===e.status?FB.logout(w):409!==e.status?($(t.Selector.fbDialogue2).empty(),corprio.formatError(e,a,o)):void FB.api("/me",{fields:"name"},(function(e){const a=`<div class="alert alert-danger"><i class="fa-regular fa-circle-exclamation"></i>&nbsp;${vdata.localizer.fbAlreadyConnected.replaceAll("{0}",e.name).replaceAll("{1}",vdata.settings.shortName)}&nbsp;<u class="text-primary"><a href="${vdata.settings.appBaseUrl}/${vdata.settings.organizationID}/ReconnectFacebook">${vdata.localizer.reconnectFacebook}</a></u>${vdata.localizer.period}</div>`;return $(t.Selector.fbDialogue2).empty().append(a),FB.logout(w)}))}});else{$(t.Selector.loginButton).show(),$(t.Selector.logoutButton).hide();const e=`<div class="alert alert-warning"><i class="fa-regular fa-circle-exclamation"></i>&nbsp;${vdata.localizer.fbNotConnected.replaceAll("{0}",vdata.settings.shortName)}</div>`;$(t.Selector.fbDialogue).empty().append(e),$(t.Selector.saveSettingButtons).attr("disabled","disabled"),$(r[t.MessageType.ProductPost].blockPanel).empty(),$(r[t.MessageType.CataloguePost].blockPanel).empty(),$(r[t.MessageType.ProductPost].previewPanel).empty(),$(r[t.MessageType.CataloguePost].previewPanel).empty()}}function T(e,a){let o=DevExpress.validationEngine.validateGroup();if(console.log(o),!o.isValid)return;if($("#ShipToCustomer").dxCheckBox("option","value")&&$("#DeliveryCharge").dxNumberBox("option","value")>0){const e=$("#DeliveryChargeProductID").dxSelectBox("instance");if(!e.option("value"))return e.option("validationStatus","invalid"),void DevExpress.ui.dialog.alert(vdata.localizer.msgMissingDeliveryChargeProductError,vdata.localizer.error)}const n=P(t.MessageType.ProductPost);if(!n.isValid)return;$("#ProductPostTemplate").val(n.templateString),$("#KeywordForShoppingIntention").val(n.keyword);const l="PRD"===vdata.settings.env?{isValid:!0,keyword:"",templateString:""}:P(t.MessageType.CataloguePost);if(!l.isValid)return;$("#CataloguePostTemplate").val(l.templateString);const s=new FormData($("#settings-form")[0]);s?$.ajax({type:"POST",url:`/${vdata.settings.organizationID}/GetStarted/Save`,data:s,cache:!1,contentType:!1,processData:!1,success:function(){e?window.open(`/${vdata.settings.organizationID}/GetStarted/PreviewCheckout`,"_blank"):a?window.open(`/${vdata.settings.organizationID}/GetStarted/PreviewThankYou`,"_blank"):DevExpress.ui.notify(vdata.localizer.msgSettingSaved,"success")},error:corprio.formatError}):console.log('Failed to find a form with selector "#settings-form"')}function w(){FB.getLoginStatus((function(e){B(e)}))}function h(e,t){return console.log(`Subscribing to page ${e}`),FB.api(`/${e}/subscribed_apps`,"post",{subscribed_fields:n.WEBHOOKS,access_token:t},(function(a){if(console.log("Response from subscribed_apps:"),console.log(a),a&&!a.error)return function(e,t){return console.log(`Turning on NLP for page ${e}`),FB.api(`/${e}/nlp_configs`,"post",{nlp_enabled:!0,model:"CHINESE",access_token:t},(function(e){console.log("Response from nlp_configs:"),console.log(e)}))}(e,t)}))}var x,M,D,O,L;window.fbAsyncInit=function(){FB.init({appId:vdata.settings.metaApiID,cookie:!0,xfbml:!0,version:vdata.settings.metaApiVersion}),FB.getLoginStatus((function(e){B(e)}))},M="script",D="facebook-jssdk",L=(x=document).getElementsByTagName(M)[0],x.getElementById(D)||((O=x.createElement(M)).id=D,O.src="https://connect.facebook.net/en_US/sdk.js",L.parentNode.insertBefore(O,L)),$((function(){$(window).on("keydown",(function(e){"Enter"!=e.key||e.preventDefault()})),$(t.Selector.loginButton).on("click",(function(){console.log("Logging into Facebook..."),FB.login((e=>{e.authResponse&&w()}),{scope:n.PERMISSIONS.toString(),return_scopes:!0})})),$(t.Selector.logoutButton).on("click",(function(){console.log("Logging out from Facebook..."),FB.logout(w)})),$("#smtp-dialogue").toggle("true"===vdata.settings.sendConfirmationEmail.toLowerCase()),$(".page-title button").on("click",(function(){$(".sidebar-wrapper").toggleClass("hidden",$(".sidebar").hasClass("show"))}));const e=$($("section").get().reverse()),a=$("#settings-nav > li > a");$("#main").on("scroll",(function(){let t=$("#main").scrollTop();e.each((function(){const e=$(this),o=e[0].offsetTop;if(t+50>=o){const t=e.attr("id"),o=$(`#settings-nav > li > a[href='#${t}']`);return o.hasClass("active")||(a.removeClass("active"),o.addClass("active")),!1}})),t+1>=$("#main")[0].scrollHeight-$("#main").height()&&(a.removeClass("active"),a.last().addClass("active"))})),a.on("click",(function(e){$(".sidebar-wrapper").addClass("hidden"),$(".sidebar").removeClass("show")})),$(t.Selector.catalogueSetting).toggle("PRD"!==vdata.settings.env),C(),y(t.MessageType.CataloguePost),y(t.MessageType.ProductPost),$(t.Selector.saveSettingButtons).on("click",(function(){T(!1,!1)})),$("#preview-checkout").on("click",(function(){T(!0,!1)})),$("#preview-thank-you").on("click",(function(){T(!1,!0)})),corprio.page.initTour({defaultTour:"getstarted.index",autoStart:!0})}))})(),o})()));