{"version":3,"file":"Index.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;;;ACFA,kGAAkG;AAClG,yCAAyC;AAEzC,MAAM,CAAC,WAAW,GAAG;IACjB,OAAO,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC;IAClD,EAAE,CAAC,IAAI,CAAC;QACJ,KAAK,EAAE,iBAAiB;QACxB,MAAM,EAAE,IAAI;QACZ,KAAK,EAAE,IAAI;QACX,OAAO,EAAE,OAAO,CAAW,4CAA4C;KAC1E,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC,KAAK,EAAE,EAAE;QACpD,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;QAC3C,CAAC,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;IACtD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,cAAc,CAAC,UAAU,QAAQ;QAChC,oBAAoB,CAAC,QAAQ,CAAC,CAAC,CAAQ,4BAA4B;IACvE,CAAC,CAAC,CAAC;AACP,CAAC,CAAC;AAEF,SAAS,oBAAoB,CAAC,QAAiC;;IAC3D,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;IACpC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAmB,0CAA0C;IACnF,IAAI,SAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,MAAM,MAAK,WAAW,EAAE,EAAI,iFAAiF;QACvH,QAAQ,EAAE,CAAC;QACX,kBAAkB,CAAC,cAAQ,CAAC,YAAY,0CAAE,MAAM,EAAE,cAAQ,CAAC,YAAY,0CAAE,WAAW,CAAC,CAAC;KACzF;SAAM,EAAkC,yDAAyD;QAC9F,CAAC,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC;KACtD;AACL,CAAC;AAED,SAAS,eAAe;IACpB,8DAA8D;IAC9D,EAAE,CAAC,cAAc,CAAC,UAAU,QAAQ;QAChC,0BAA0B;QAC1B,oBAAoB,CAAC,QAAQ,CAAC;IAClC,CAAC,CAAC;AACN,CAAC;AAED,SAAS,kBAAkB,CAAC,MAAc,EAAE,WAAmB;IAC3D,OAAO,CAAC,CAAC,IAAI,CAAC;QACV,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,kBAAkB;QACrC,IAAI,EAAE;YACF,MAAM,EAAE,MAAM;YACd,KAAK,EAAE,WAAW;SACrB;KACJ,CAAC,CAAC,IAAI,CAAC;QACJ,OAAO,CAAC,GAAG,CAAC,aAAa,MAAM,kCAAkC,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC,IAAI,CAAC;QACJ,OAAO,CAAC,GAAG,CAAC,gCAAgC,MAAM,cAAc,CAAC,CAAC;IACtE,CAAC,CAAC,CAAC;AACP,CAAC;AAED,2GAA2G;AAC3G,SAAS,oBAAoB,CAAC,OAAe,EAAE,iBAAyB;IACpE,OAAO,CAAC,GAAG,CAAC,uBAAuB,OAAO,KAAK,CAAC,CAAC;IACjD,OAAO,EAAE,CAAC,GAAG,CACT,IAAI,OAAO,kBAAkB,EAC7B,MAAM,EACN;QACI,iBAAiB,EAAE;YACf,MAAM;YACN,iHAAiH;YACjH,UAAU;YACV,mGAAmG;SACtG;QACD,YAAY,EAAE,iBAAiB;KAClC,EACD,UAAU,QAAa;QACnB,IAAI,QAAQ,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;YAC7B,OAAO,CAAC,GAAG,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;SAC7B;aAAM;YACH,OAAO,CAAC,KAAK,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,KAAK,CAAC,CAAC;SAClC;IACL,CAAC,CACJ;AACL,CAAC;AAED,SAAS,QAAQ;IACb,EAAE,CAAC,GAAG,CAAC,cAAc,EAAE,UAAU,QAAqC;QAClE,IAAI,QAAQ,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;YAC7B,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;YAC3C,OAAO,CAAC,GAAG,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;YAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC3C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;gBACpC,MAAM,iBAAiB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC;gBACxD,oBAAoB,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAAC;aACpD;SACJ;aAAM;YACH,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;SACjC;IACL,CAAC,CAAC;AACN,CAAC","sources":["webpack://vjs/webpack/universalModuleDefinition","webpack://vjs/./Views/MetaApi/Index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vjs\"] = factory();\n\telse\n\t\troot[\"vjs\"] = factory();\n})(self, () => {\nreturn ","declare const vdata: {\r\n    actions: {\r\n        refreshAccessToken: string;\r\n    };\r\n    applicationSetting: {\r\n    };\r\n};\r\n\r\n// https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/facebook-js-sdk/index.d.ts\r\n/// <reference types=\"facebook-js-sdk\" />\r\n\r\nwindow.fbAsyncInit = function () {\r\n    console.log('fbAsyncInit is doing its things...');\r\n    FB.init({\r\n        appId: '312852768233605',\r\n        cookie: true,                     // Enable cookies to allow the server to access the session.\r\n        xfbml: true,                     // Parse social plugins on this webpage.\r\n        version: 'v18.0'           // Use this Graph API version for this call.\r\n    });\r\n\r\n    document.addEventListener(\"DOMContentLoaded\", (event) => {\r\n        console.log(\"DOM fully loaded and parsed\");\r\n        $('fb:login-button').on('click', checkLoginState);\r\n    });\r\n\r\n    FB.getLoginStatus(function (response) {   // Called after the JS SDK has been initialized.\r\n        statusChangeCallback(response);        // Returns the login status.\r\n    });\r\n};\r\n\r\nfunction statusChangeCallback(response: facebook.StatusResponse) {  // Called with the results from FB.getLoginStatus().\r\n    console.log('statusChangeCallback');\r\n    console.log(response);                   // The current login status of the person.\r\n    if (response?.status === 'connected') {   // Logged into your webpage and Facebook.                                        \r\n        getPages();\r\n        refreshAccessToken(response.authResponse?.userID, response.authResponse?.accessToken);\r\n    } else {                                 // Not logged into your webpage or we are unable to tell.\r\n        $('#status').text('Please log into this webpage.');\r\n    }\r\n}\r\n\r\nfunction checkLoginState() {\r\n    // Called when a person is finished with the Login Button.    \r\n    FB.getLoginStatus(function (response) {\r\n        // See the onlogin handler\r\n        statusChangeCallback(response)\r\n    })\r\n}\r\n\r\nfunction refreshAccessToken(metaId: string, accessToken: string) {\r\n    return $.post({\r\n        url: vdata.actions.refreshAccessToken,\r\n        data: {\r\n            metaId: metaId,\r\n            token: accessToken,            \r\n        }\r\n    }).done(function () {\r\n        console.log(`Token for ${metaId} is fed to backend successfully.`);\r\n    }).fail(function () {\r\n        console.log(`Failed to pass the token for ${metaId} to backend.`);\r\n    });\r\n}\r\n\r\n// add webhooks to page subscriptions (IMPORTANT: subscribe to the fields as those subscribed on App level)\r\nfunction addPageSubscriptions(page_id: string, page_access_token: string) {\r\n    console.log(`Subscribing to page ${page_id}...`);\r\n    return FB.api(\r\n        `/${page_id}/subscribed_apps`,\r\n        'post',\r\n        {\r\n            subscribed_fields: [\r\n                'feed',\r\n                // webhook for pages: https://developers.facebook.com/docs/graph-api/webhooks/getting-started/webhooks-for-pages/\r\n                'messages',\r\n                // any other webhook event: https://developers.facebook.com/docs/messenger-platform/webhook/#events\r\n            ],\r\n            access_token: page_access_token,\r\n        },\r\n        function (response: any) {\r\n            if (response && !response.error) {\r\n                console.log({ response });                \r\n            } else {\r\n                console.error(response?.error);\r\n            }\r\n        },\r\n    )\r\n}\r\n\r\nfunction getPages() {\r\n    FB.api('/me/accounts', function (response: facebook.AuthResponse | any) {\r\n        if (response && !response.error) {\r\n            console.log('response from getPages()...');\r\n            console.log({ response });            \r\n            for (let i = 0; i < response.data.length; i++) {\r\n                const page_id = response.data[i].id;\r\n                const page_access_token = response.data[i].access_token;                \r\n                addPageSubscriptions(page_id, page_access_token);\r\n            }\r\n        } else {\r\n            console.error(response.error);\r\n        }\r\n    })\r\n}\r\n"],"names":[],"sourceRoot":""}